{% extends "index.html" %}
{% block content %}

<h1>Buscar por...</h1>

<div class="info card">
    <form id="template" method="POST" action="/">
        <select name="option" id="menu" onchange="this.form.submit()">
            <option class="option">Seleccione</option>
            <option value="city" class="option">Nombre de la ciudad</option>
            <option value="iata_code" class="option">Código IATA</option>
            <option value="flight_number" class="option">Número de vuelo</option>
        </select>
    </form>

    <form class="input" method="POST" action="/">
      <div id="cityInput" class="content">
        <label for="city"></label>
        <template id="listtemplate"> 
          {% for city in datalist_options %}
          <option value="{{ city }}">
          {% endfor %}
      </template>
      <input type="text" id="city" name="city" list="listprod" class="form-control " placeholder="Ej. Ciudad de México" autocomplete="off" value="{{ city }}">
      <datalist id="listprod">
      </datalist>
      {% set lower_options = datalist_options | map('lower') %}
      {% if city and city.lower() not in lower_options %}
        <p class="link-size">Quizá quisiste decir: <a href="http://127.0.0.1:5000" class="custom-link">{{ suggestion }}</a></p>
      {% endif %}
      </div>
      <script>
        var search = document.querySelector('#city');
        var results = document.querySelector('#listprod');
        var templateContent = document.querySelector('#listtemplate').content;
        search.addEventListener('keyup', function handler(event) {
            while (results.children.length) results.removeChild(results.firstChild);
            var inputVal = new RegExp(search.value.trim(), 'i');
            var set = Array.prototype.reduce.call(templateContent.cloneNode(true).children, function searchFilter(frag, item, i) {
                if (inputVal.test(item.value) && frag.children.length < 5) frag.appendChild(item);
                return frag;
            }, document.createDocumentFragment());
            results.appendChild(set);
        });
      </script>
      <button  type="submit"></button>
    </form>
</div>

<div class="error">
  {% if error %}
      <p>{{ error }}</p>
  {% endif %}
</div>

{% if departure_weather %}
<div class="card weather-card" id="departure_card">
  <h2 class="city-name">Ciudad de salida: {{ departure_weather['name'] }}</h2>
  <h1 class="temperature">{{ departure_weather['main']['temp'] }}°C</h1>
  <div class="weather-info">
    <img class="weather-icon" src="{{ departure_weather['weather'][0]['icon'] }}" alt="Weather icon" />
    <p class="weather-description">{{ departure_weather['weather'][0]['description'] | capitalize }}</p>
  </div>
  <div class="stats">
    <article class="stat">
      <img class="stat-icon" src="{{ url_for('static', filename='svg/humedad.svg') }}" alt="IMG-Humedad" />
      <p class="stat-value">{{ departure_weather['main']['humidity'] }}%</p>
      <p class="stat-label">Humedad</p>
    </article>
    <article class="stat">
      <img class="stat-icon" src="{{ url_for('static', filename='svg/viento.svg') }}" alt="IMG-Viento" />
      <p class="stat-value">{{ departure_weather['wind']['speed'] }} m/s</p>
      <p class="stat-label">Velocidad de viento</p>
    </article>
  </div>
</div>
{% endif %}

{% endblock %}